<tool id="interactive_tool_chat_analysis" tool_type="interactive" name="Chat with your data" version="0.1">
    <requirements>
        <container type="docker">
            quay.io/goeckslab/chatanalysis:latest
        </container>
    </requirements>
    <entry_points>
        <entry_point name="Chat with $input_csv.element_identifier" requires_domain="True">
            <port>
                8501
            </port>
            <url>
                /
            </url>
        </entry_point>
    </entry_points>
    <command>
        <![CDATA[
        echo "Starting Streamlit" &&
        echo "Script executed from: `pwd`" &&
        cd /ChatAnalysis &&
        ln -sf $__tool_directory__/.env .env &&
        streamlit run chat_analysis.py
            $openai_api_key_file 
            $chat_history
            #if $input_csv
            $input_csv 
            #end if

        ]]>
    </command>
    <configfiles>
        <configfile name="openai_api_key_file"><![CDATA[
            $__user__.extra_preferences.get('chatapt|api_key')
        ]]></configfile>
    </configfiles>
    <stdio>
        <exit_code range="0:0" level="log"/>
    </stdio>
    <inputs>
        <param name="input_csv"  type="data" format="csv,tabular" label="Data(csv or tsv) you want to chat with" optional="true"/>
    </inputs>
    <outputs>
        <data name="chat_history" format="html" label="${tool.name} chat history on ${on_string}"/>
    </outputs>
    <tests>
    </tests>
    <help>
        Analyze and visualize a dataset with a Chat Agent.
        
        Simply start a ChatAnalysis instance after selecting a dataset because we provide free access to Groq API and BambooLLM API.
        
        Or if you wish to set the OpenAI API key beforehand, you can do so in User - Preferences - Manage Information - ChatGPT - OpenAI API Key. This way, you won't need to set OpenAI API key every time you use the app.
        
        Or you can set the API key directly in the ChatAnalysis instance once it has started.
    </help>
</tool>


